<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       ../schemas/dbchangelog-3.6.xsd"
                   logicalFilePath="changelog-0.0.3">

    <changeSet id="0.0.3-01" author="SunriseCoder">

        <createTable tableName="users">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_users" nullable="false" />
            </column>
            <column name="login" type="varchar(32)">
                <constraints unique="true" uniqueConstraintName="ui_users_login" nullable="false" />
            </column>
            <column name="pass" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="display_name" type="varchar(64)">
                <constraints unique="true" uniqueConstraintName="ui_users_display_name" nullable="false" />
            </column>
            <column name="email" type="varchar(64)">
                <constraints unique="true" uniqueConstraintName="ui_users_email" nullable="false" />
            </column>
            <column name="should_change_password" type="boolean">
                <constraints nullable="false" />
            </column>
            <column name="system" type="boolean">
                <constraints nullable="false" />
            </column>
        </createTable>

        <insert tableName="users">
            <column name="id" value="1" />
            <column name="login" value="system" />
            <column name="pass" value="" /><!-- no way to login as system user -->
            <column name="display_name" value="System" />
            <column name="email" value="1" />
            <column name="should_change_password" valueBoolean="false" />
            <column name="system" valueBoolean="true" />
        </insert>

        <insert tableName="users">
            <column name="id" value="2" />
            <column name="login" value="anonymousUser" />
            <column name="pass" value="" /><!-- no way to login as anonymousUser -->
            <column name="display_name" value="Anonymous" />
            <column name="email" value="0" />
            <column name="should_change_password" valueBoolean="false" />
            <column name="system" valueBoolean="true" />
        </insert>

        <insert tableName="users">
            <column name="id" value="3" />
            <column name="login" value="admin" />
            <column name="pass" value="$2a$10$hHBkdPDV.oI6pXhmbLYdJucXyMl3FPWL3cHzSwm/0ieSwamSQ7fT6" /><!-- "password" -->
            <column name="display_name" value="Admin" />
            <column name="email" value="ch@ange.it" />
            <column name="should_change_password" valueBoolean="true" />
            <column name="system" valueBoolean="false" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-02" author="SunriseCoder">

        <createTable tableName="z_user_locks">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_user_locks" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" unique="true" uniqueConstraintName="ui_user_locks_user_id"
                             foreignKeyName="fk_z_user_locks_user" referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="reason" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="locked_by_id" type="bigint">
                <constraints nullable="false"
                             foreignKeyName="fk_z_user_locks_by" referencedTableName="users" referencedColumnNames="id" />
            </column>
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-03" author="SunriseCoder">

        <createTable tableName="z_user_confirms">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_user_confirms" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="false" unique="true" uniqueConstraintName="ui_user_confirms_user_id"
                             foreignKeyName="fk_z_user_confirms_user" referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="comment" type="varchar(64)" />
            <column name="confirmed_by_id" type="bigint">
                <constraints nullable="false"
                             foreignKeyName="fk_z_user_confirms_by" referencedTableName="users" referencedColumnNames="id" />
            </column>
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-04" author="SunriseCoder">

        <createTable tableName="persistent_logins">
            <column name="username" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="series" type="varchar(64)">
                <constraints primaryKey="true" primaryKeyName="pk_persistent_logins" nullable="false" />
            </column>
            <column name="token" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="last_used" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-05" author="SunriseCoder">

        <createTable tableName="e_permissions">
            <column autoIncrement="true" name="id" type="bigint">
                <constraints primaryKey="true" primaryKeyName="pk_e_permissions" />
            </column>
            <column name="name" type="VARCHAR(64)">
                <constraints unique="true" uniqueConstraintName="ui_permissions_name" nullable="false" />
            </column>
            <column name="comment" type="VARCHAR(255)" />
        </createTable>

        <insert tableName="e_permissions">
            <column name="id" value="1" />
            <column name="name" value="ADMIN_PAGE" />
            <column name="comment" value="Allows access to administration section" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="2" />
            <column name="name" value="UPLOAD_FILES" />
            <column name="comment" value="Allows users to upload files to server" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="3" />
            <column name="name" value="ADMIN_DASHBOARD" />
            <column name="comment" value="Allows access to administration dashboard" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="4" />
            <column name="name" value="ADMIN_USERS_VIEW" />
            <column name="comment" value="Allows access to View user information" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="5" />
            <column name="name" value="ADMIN_USERS_EDIT" />
            <column name="comment" value="Allows access to Edit user information" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="6" />
            <column name="name" value="ADMIN_USERS_ROLES" />
            <column name="comment" value="Allows access to change user permissions" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="7" />
            <column name="name" value="ADMIN_USERS_LOCK" />
            <column name="comment" value="Allows to lock users" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="8" />
            <column name="name" value="ADMIN_USERS_UNLOCK" />
            <column name="comment" value="Allows to unlock users" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="9" />
            <column name="name" value="PAGES_VIEW" />
            <column name="comment" value="Allows to view base pages" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="10" />
            <column name="name" value="ADMIN_USERS_CONFIRM" />
            <column name="comment" value="Allows to confirm user identity" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="11" />
            <column name="name" value="ADMIN_USERS_UNCONFIRM" />
            <column name="comment" value="Allows to reject identity confirmation" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="12" />
            <column name="name" value="ADMIN_ROLES_VIEW" />
            <column name="comment" value="Allows to reject identity confirmation" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="13" />
            <column name="name" value="ADMIN_ROLES_EDIT" />
            <column name="comment" value="Allows to reject identity confirmation" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="14" />
            <column name="name" value="ADMIN_AUDIT_VIEW" />
            <column name="comment" value="Allows to view audit events" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="15" />
            <column name="name" value="ADMIN_LOGS_VIEW" />
            <column name="comment" value="Allows to view server logs" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="16" />
            <column name="name" value="ADMIN_IPBAN_VIEW" />
            <column name="comment" value="Allows to view list of banned IP-addresses" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="17" />
            <column name="name" value="ADMIN_IPBAN_EDIT" />
            <column name="comment" value="Allows to add and remove IP-addresses from ban list" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="18" />
            <column name="name" value="USER_LOGGED_IN" />
            <column name="comment" value="User should be registered and logged in" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="19" />
            <column name="name" value="USER_LOGGED_OUT" />
            <column name="comment" value="User should be not logged in" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="20" />
            <column name="name" value="ADMIN_CACHE_VIEW" />
            <column name="comment" value="Server administration - view cache states" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="21" />
            <column name="name" value="ADMIN_CACHE_REFRESH" />
            <column name="comment" value="Server administration - refresh cache" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="22" />
            <column name="name" value="ADMIN_FESTIVALS_ADD" />
            <column name="comment" value="Festival administration - add new festivals" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="23" />
            <column name="name" value="ADMIN_FESTIVALS_EDIT" />
            <column name="comment" value="Festival administration - edit any festival" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="24" />
            <column name="name" value="ADMIN_FESTIVALS_DELETE" />
            <column name="comment" value="Festival administration - delete any festival" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="25" />
            <column name="name" value="ADMIN_PLACES_VIEW" />
            <column name="comment" value="Read-only access to place page" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="26" />
            <column name="name" value="ADMIN_PLACES_EDIT" />
            <column name="comment" value="Places administration - add/edit/delete" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="27" />
            <column name="name" value="ADMIN_EXTJOBS_VIEW" />
            <column name="comment" value="External jobs view-only access" />
        </insert>

        <insert tableName="e_permissions">
            <column name="id" value="28" />
            <column name="name" value="ADMIN_EXTJOBS_KILL" />
            <column name="comment" value="External jobs permission to kill jobs" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-06" author="SunriseCoder">

        <createTable tableName="roles">
            <column autoIncrement="true" name="id" type="bigint">
                <constraints primaryKey="true" primaryKeyName="rolesPK" />
            </column>
            <column name="name" type="VARCHAR(64)">
                <constraints unique="true" uniqueConstraintName="ui_roles_name" nullable="false" />
            </column>
            <column name="comment" type="VARCHAR(255)" />
        </createTable>

        <insert tableName="roles">
            <column name="id" value="1" />
            <column name="name" value="Anonymous" />
            <column name="comment" value="Role to use when user did not log in" />
        </insert>

        <insert tableName="roles">
            <column name="id" value="2" />
            <column name="name" value="Admin" />
            <column name="comment" value="Admin with full permissions" />
        </insert>

        <insert tableName="roles">
            <column name="id" value="3" />
            <column name="name" value="Moder" />
            <column name="comment" value="Moderator with partial administration permissions" />
        </insert>

        <insert tableName="roles">
            <column name="id" value="4" />
            <column name="name" value="Editor" />
            <column name="comment" value="Site content editor" />
        </insert>

        <insert tableName="roles">
            <column name="id" value="5" />
            <column name="name" value="User" />
            <column name="comment" value="Just an ordinary registered user" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-07" author="SunriseCoder">

        <createTable tableName="zz_roles_permissions">
            <column name="role_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_zz_roles_permissions_role"
                    referencedTableName="roles" referencedColumnNames="id" />
            </column>
            <column name="permission_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_zz_roles_permissions_permission"
                    referencedTableName="e_permissions" referencedColumnNames="id" />
            </column>
        </createTable>

        <!-- Grant Permission PAGES_VIEW to Role Anonymous -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="1" />
            <column name="permission_id" value="9" />
        </insert>

        <!-- Grant Permission ADMIN_PAGE to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="1" />
        </insert>

        <!-- Grant Permission UPLOAD_FILES to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="2" />
        </insert>

        <!-- Grant Permission ADMIN_DASHBOARD to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="3" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="4" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_EDIT to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="5" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_ROLES to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="6" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_LOCK to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="7" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_UNLOCK to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="8" />
        </insert>

        <!-- Grant Permission PAGES_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="9" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_CONFIRM to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="10" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_UNCONFIRM to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="11" />
        </insert>

        <!-- Grant Permission ADMIN_ROLES_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="12" />
        </insert>

        <!-- Grant Permission ADMIN_ROLES_EDIT to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="13" />
        </insert>

        <!-- Grant Permission ADMIN_AUDIT_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="14" />
        </insert>

        <!-- Grant Permission ADMIN_LOGS_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="15" />
        </insert>

        <!-- Grant Permission ADMIN_IPBAN_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="16" />
        </insert>

        <!-- Grant Permission ADMIN_IPBAN_EDIT to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="17" />
        </insert>

        <!-- Grant Permission ADMIN_CACHE_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="20" />
        </insert>

        <!-- Grant Permission ADMIN_CACHE_REFRESH to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="21" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_ADD to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="22" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_EDIT to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="23" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_DELETE to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="24" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="25" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_EDIT to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="26" />
        </insert>

        <!-- Grant Permission ADMIN_EXTJOBS_VIEW to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="27" />
        </insert>

        <!-- Grant Permission ADMIN_EXTJOBS_KILL to Role Admin -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="2" />
            <column name="permission_id" value="28" />
        </insert>

        <!-- Grant Permission ADMIN_PAGE to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="1" />
        </insert>

        <!-- Grant Permission UPLOAD_FILES to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="2" />
        </insert>

        <!-- Grant Permission ADMIN_DASHBOARD to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="3" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_VIEW to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="4" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_EDIT to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="5" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_LOCK to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="7" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_UNLOCK to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="8" />
        </insert>

        <!-- Grant Permission PAGES_VIEW to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="9" />
        </insert>

        <!-- Grant Permission ADMIN_USERS_CONFIRM to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="10" />
        </insert>

        <!-- Grant Permission ADMIN_ROLES_VIEW to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="12" />
        </insert>

        <!-- Grant Permission ADMIN_IPBAN_VIEW to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="16" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_ADD to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="22" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_EDIT to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="23" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_DELETE to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="24" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_VIEW to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="25" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_EDIT to Role Moder -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="3" />
            <column name="permission_id" value="26" />
        </insert>

        <!-- Grant Permission UPLOAD_FILES to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="2" />
        </insert>

        <!-- Grant Permission PAGES_VIEW to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="9" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_ADD to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="22" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_EDIT to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="23" />
        </insert>

        <!-- Grant Permission ADMIN_FESTIVALS_DELETE to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="24" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_VIEW to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="25" />
        </insert>

        <!-- Grant Permission ADMIN_PLACES_EDIT to Role Editor -->
        <insert tableName="zz_roles_permissions">
            <column name="role_id" value="4" />
            <column name="permission_id" value="26" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-08" author="SunriseCoder">

        <createTable tableName="zz_users_roles">
            <column name="user_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_zz_users_roles_user"
                    referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="role_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_zz_users_roles_role"
                    referencedTableName="roles" referencedColumnNames="id" />
            </column>
        </createTable>

        <!-- Grant Role Admin to User Admin -->
        <insert tableName="zz_users_roles">
            <column name="user_id" value="3" />
            <column name="role_id" value="2" />
        </insert>

        <!-- Grant Role Anonymous to User Anonymous -->
        <insert tableName="zz_users_roles">
            <column name="user_id" value="2" />
            <column name="role_id" value="1" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-09" author="SunriseCoder">

        <createTable tableName="e_audit_event_types">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_e_audit_event_types" nullable="false" />
            </column>
            <column name="name" type="varchar(64)">
                <constraints unique="true" uniqueConstraintName="ui_audit_event_type_name" nullable="false" />
            </column>
            <column name="comment" type="varchar(64)" />
            <column name="severity" type="tinyint">
                <constraints nullable="false" />
            </column>
        </createTable>

        <insert tableName="e_audit_event_types">
            <column name="id" value="1" />
            <column name="name" value="ACCESS_ALLOWED" />
            <column name="comment" value="Access to particular resource is allowed" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="2" />
            <column name="name" value="ACCESS_DENIED" />
            <column name="comment" value="Access to particular resource is denied" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="3" />
            <column name="name" value="SUSPICIOUS_ACTIVITY" />
            <column name="comment" value="Assumption that somebody breaking or hacking the system" />
            <column name="severity" valueNumeric="3" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="4" />
            <column name="name" value="AUDIT_FAILURE" />
            <column name="comment" value="Audit failure" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="5" />
            <column name="name" value="DELETE_ERROR" />
            <column name="comment" value="Error due to delete an entity" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="6" />
            <column name="name" value="ENTITY_NOT_EXISTS" />
            <column name="comment" value="Entity was not found" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="7" />
            <column name="name" value="INVALID_STATE" />
            <column name="comment" value="Operation is not applicable to the current state" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="8" />
            <column name="name" value="SAVING_ERROR" />
            <column name="comment" value="Saving error, however validation was passed" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="9" />
            <column name="name" value="VALIDATION_ERROR" />
            <column name="comment" value="Incorrect field value" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="10" />
            <column name="name" value="IO_ERROR" />
            <column name="comment" value="Input/Output operation error" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="11" />
            <column name="name" value="PAGE_NOT_FOUND" />
            <column name="comment" value="Unknown page" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_audit_event_types">
            <column name="id" value="12" />
            <column name="name" value="SUCCESSFUL" />
            <column name="comment" value="Operation completed successfully" />
            <column name="severity" valueNumeric="0" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-10" author="SunriseCoder">

        <createTable tableName="e_operation_types">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_e_operation_types" nullable="false" />
            </column>
            <column name="name" type="varchar(64)">
                <constraints unique="true" uniqueConstraintName="ui_operation_type_name" nullable="false" />
            </column>
            <column name="comment" type="varchar(64)" />
            <column name="severity" type="tinyint">
                <constraints nullable="false" />
            </column>
        </createTable>

        <insert tableName="e_operation_types">
            <column name="id" value="1" />
            <column name="name" value="ACCESS_ADMIN_AUDIT" />
            <column name="comment" value="Access to admin audit page" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="2" />
            <column name="name" value="ACCESS_ADMIN_DASHBOARD" />
            <column name="comment" value="Access to admin dashboard page" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="3" />
            <column name="name" value="ACCESS_ADMIN_IPBAN" />
            <column name="comment" value="Access to banned IP-addresses page" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="4" />
            <column name="name" value="ACCESS_ADMIN_LOGS" />
            <column name="comment" value="Access to server log files" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="5" />
            <column name="name" value="ACCESS_PAGE_FILES" />
            <column name="comment" value="Access to files page" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="6" />
            <column name="name" value="ACCESS_PAGE_MAIN" />
            <column name="comment" value="Access to main page" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="7" />
            <column name="name" value="ACCESS_PAGE_UPLOAD" />
            <column name="comment" value="Access to upload file page" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="8" />
            <column name="name" value="ACCESS_ROLE_LIST" />
            <column name="comment" value="Viewing role list" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="9" />
            <column name="name" value="ACCESS_ROLE_CREATE" />
            <column name="comment" value="Access role creation form" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="10" />
            <column name="name" value="ACCESS_ROLE_EDIT" />
            <column name="comment" value="Access role editing form" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="11" />
            <column name="name" value="ACCESS_USER_LIST" />
            <column name="comment" value="Viewing user list" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="12" />
            <column name="name" value="ACCESS_USER_EDIT" />
            <column name="comment" value="Changing user data" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="13" />
            <column name="name" value="ACCESS_USER_LOGIN" />
            <column name="comment" value="User logs in" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="14" />
            <column name="name" value="ACCESS_USER_LOGOUT" />
            <column name="comment" value="User logs out" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="15" />
            <column name="name" value="ACCESS_PAGE_ERROR" />
            <column name="comment" value="User requests error page" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="16" />
            <column name="name" value="ACCESS_PAGE_STATIC" />
            <column name="comment" value="Access static resource like script or image" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="17" />
            <column name="name" value="ACCESS_PAGE_UNKNOWN" />
            <column name="comment" value="User requests unknown page" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="18" />
            <column name="name" value="CHANGE_FILE_UPLOAD" />
            <column name="comment" value="Attempt to upload a file" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="19" />
            <column name="name" value="CHANGE_IPBAN_ADD" />
            <column name="comment" value="Attempt to ban an IP-address" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="20" />
            <column name="name" value="CHANGE_IPBAN_REMOVE" />
            <column name="comment" value="Attempt to remove IP-address from the ban list" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="21" />
            <column name="name" value="CHANGE_ROLE_SAVE" />
            <column name="comment" value="Attempt to save role changes" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="22" />
            <column name="name" value="CHANGE_ROLE_DELETE" />
            <column name="comment" value="Attempt to delete role" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="23" />
            <column name="name" value="CHANGE_USER_REGISTER" />
            <column name="comment" value="Attempt to register new user" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="24" />
            <column name="name" value="CHANGE_USER_PROFILE" />
            <column name="comment" value="User changes his profile himself" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="25" />
            <column name="name" value="CHANGE_USER_LOGIN" />
            <column name="comment" value="Changing user login" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="26" />
            <column name="name" value="CHANGE_USER_PASSWORD" />
            <column name="comment" value="Changing user password" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="27" />
            <column name="name" value="CHANGE_USER_DISPLAY_NAME" />
            <column name="comment" value="Changing user display name" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="28" />
            <column name="name" value="CHANGE_USER_EMAIL" />
            <column name="comment" value="Changing user email" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="29" />
            <column name="name" value="CHANGE_USER_ROLES" />
            <column name="comment" value="Changing user roles" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="30" />
            <column name="name" value="CHANGE_USER_CONFIRM" />
            <column name="comment" value="Confirming identity of the user" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="31" />
            <column name="name" value="CHANGE_USER_UNCONFIRM" />
            <column name="comment" value="Reject identity confirmation of the user" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="32" />
            <column name="name" value="CHANGE_USER_LOCK" />
            <column name="comment" value="Restricting user access to the portal" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="33" />
            <column name="name" value="CHANGE_USER_UNLOCK" />
            <column name="comment" value="Restoring access for the user to the portal" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="34" />
            <column name="name" value="SAVE_AUDIT_EVENT" />
            <column name="comment" value="Saving audit event" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="35" />
            <column name="name" value="SAVE_STATISTIC_LOG" />
            <column name="comment" value="Saving statistic log record" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="36" />
            <column name="name" value="ACCESS_ADMIN_CACHE" />
            <column name="comment" value="Access cache list" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="37" />
            <column name="name" value="REFRESH_ADMIN_CACHE" />
            <column name="comment" value="Update system cache" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="38" />
            <column name="name" value="ACCESS_PAGE_FESTIVALS" />
            <column name="comment" value="Access to the festivals page" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="39" />
            <column name="name" value="CHANGE_FESTIVAL_ADD" />
            <column name="comment" value="Add new festival" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="40" />
            <column name="name" value="CHANGE_FESTIVAL_EDIT" />
            <column name="comment" value="Edit existing festival created by other person" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="41" />
            <column name="name" value="CHANGE_FESTIVAL_DELETE" />
            <column name="comment" value="Delete festival" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="42" />
            <column name="name" value="CHANGE_PLACE_ADD" />
            <column name="comment" value="Add festival place" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="43" />
            <column name="name" value="CHANGE_PLACE_EDIT" />
            <column name="comment" value="Change festival place" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="44" />
            <column name="name" value="CHANGE_PLACE_DELETE" />
            <column name="comment" value="Delete festival place" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="45" />
            <column name="name" value="ACCESS_PLACE_LIST" />
            <column name="comment" value="Access places list page" />
            <column name="severity" valueNumeric="0" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="46" />
            <column name="name" value="ACCESS_PLACE_ADD" />
            <column name="comment" value="Access page - add place" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="47" />
            <column name="name" value="ACCESS_PLACE_EDIT" />
            <column name="comment" value="Access page - edit place" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="48" />
            <column name="name" value="ADMIN_IP_BAN" />
            <column name="comment" value="Ban IP-address of the user" />
            <column name="severity" valueNumeric="3" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="49" />
            <column name="name" value="ACCESS_USER_PASSWORD" />
            <column name="comment" value="Access page to change own password" />
            <column name="severity" valueNumeric="1" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="50" />
            <column name="name" value="ACCESS_ADMIN_EXTJOBS" />
            <column name="comment" value="Access external jobs status information" />
            <column name="severity" valueNumeric="2" />
        </insert>

        <insert tableName="e_operation_types">
            <column name="id" value="51" />
            <column name="name" value="CHANGE_EXTJOBS_KILL" />
            <column name="comment" value="Access to kill external jobs" />
            <column name="severity" valueNumeric="3" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-11" author="SunriseCoder">

        <createTable tableName="audit_events">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_audit_events" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints foreignKeyName="fk_audit_events_user"
                             referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="date" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="ip" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="operation_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_audit_events_operation_type"
                             referencedTableName="e_operation_types" referencedColumnNames="id" />
            </column>
            <column name="type_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_audit_events_type"
                             referencedTableName="e_audit_event_types" referencedColumnNames="id" />
            </column>
            <column name="object_before" type="varchar(1024)" />
            <column name="object_after" type="varchar(1024)" />
            <column name="error" type="varchar(1024)" />
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-12" author="SunriseCoder">

        <createTable tableName="statistic_logs">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_statistic_logs" nullable="false" />
            </column>
            <column name="user_id" type="bigint">
                <constraints foreignKeyName="fk_statistic_logs_user"
                             referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="date_time" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="ip" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="url" type="varchar(255)">
                <constraints nullable="false" />
            </column>
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-13" author="SunriseCoder">

        <createTable tableName="ip_bans">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_ip_bans" nullable="false" />
            </column>
            <column name="ip" type="varchar(64)">
                <constraints unique="true" uniqueConstraintName="ui_ip_bans_ip" nullable="false" />
            </column>
            <column name="date" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="banned_by_id" type="bigint">
                <constraints foreignKeyName="fk_ip_bans_user"
                             referencedTableName="users" referencedColumnNames="id" />
            </column>
            <column name="reason" type="varchar(64)">
                <constraints nullable="false" />
            </column>
        </createTable>

    </changeSet>

    <changeSet id="0.0.3-14" author="SunriseCoder">

        <createTable tableName="places">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_places" nullable="false" />
            </column>
            <column name="parent_id" type="bigint">
                <constraints nullable="true" foreignKeyName="fk_places_parent"
                             referencedTableName="places" referencedColumnNames="id" />
            </column>
            <column name="name" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="system" type="boolean">
                <constraints nullable="false" />
            </column>
            
        </createTable>

        <insert tableName="places">
            <column name="id" value="1" />
            <column name="name" value="Other" />
            <column name="system" valueBoolean="true" />
        </insert>

    </changeSet>

    <changeSet id="0.0.3-15" author="SunriseCoder">

        <createTable tableName="festivals">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_festivals" nullable="false" />
            </column>
            <column name="details" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="start" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="end" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="place_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_festivals_place"
                             referencedTableName="places" referencedColumnNames="id" />
            </column>
            <column name="added_by_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_festivals_added_by"
                             referencedTableName="users" referencedColumnNames="id" />
            </column>
        </createTable>

    </changeSet>

</databaseChangeLog>
